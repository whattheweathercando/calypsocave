<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CC - Fetch Data from Airtable API</title>
</head>
<body>
    <button id="getData">Get CC Data</button>
    <button id="initRecordLinks">Init record links</button>
    <div id="output"></div>
<script>

// Fetch variables
const token = 'keyQEt7ap2NN2NF2h';
const baseUrl = 'https://api.airtable.com/v0/appLR6Kx7gDtp6taX/CC-main'
const queryParams = 'maxRecords=8&view=all'
// const queryParams = 'view=all'
const url = `${baseUrl}?${queryParams}`

// Fetch Function
function getRecordListing(){

    fetch(url, {
        headers: {
            Authorization: `Bearer ${token}`
        }
    })
    .then(res => res.json())
    .then(async data => {
        // console.log(data);
        let output = `<h2>CC Airtable Records</h2>`
        data.records.forEach( (record, index) => {
        //data.records.forEach(function(record, index){
            output += `
                <div>
                    <div>${index}</div>
                    <div><button type="button" class="get-single-record" data-record-id="${record.id}">${record.id}</button></div>
                    <div>${record.fields.caption}</div>
                </div>
                <br>
            `
        });
        document.querySelector('#output').innerHTML = output
    });
}

function getSingleRecord(event){
    let id = event.target.dataset.recordId;
    console.log(`Fetch record ${id}`);
}



function initRecordLinks(){
    let recordLinks = document.querySelectorAll('.get-single-record')
    recordLinks.forEach(element => {
        addEventListener('click', getSingleRecord)
    })  
}

document.querySelector('#getData').addEventListener('click', getRecordListing);
document.querySelector('#initRecordLinks').addEventListener('click', initRecordLinks);


</script>
</body>
</html>